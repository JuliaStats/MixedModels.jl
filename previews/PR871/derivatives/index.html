<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Gradient and Hessian computation · MixedModels</title><meta name="title" content="Gradient and Hessian computation · MixedModels"/><meta property="og:title" content="Gradient and Hessian computation · MixedModels"/><meta property="twitter:title" content="Gradient and Hessian computation · MixedModels"/><meta name="description" content="Documentation for MixedModels."/><meta property="og:description" content="Documentation for MixedModels."/><meta property="twitter:description" content="Documentation for MixedModels."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="MixedModels logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">MixedModels</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">MixedModels.jl Documentation</a></li><li><a class="tocitem" href="../constructors/">Model constructors</a></li><li><a class="tocitem" href="../optimization/">Details of the parameter estimation</a></li><li><a class="tocitem" href="../GaussHermite/">Normalized Gauss-Hermite Quadrature</a></li><li><a class="tocitem" href="../prediction/">Prediction and simulation in Mixed-Effects Models</a></li><li><a class="tocitem" href="../bootstrap/">Parametric bootstrap for mixed-effects models</a></li><li><a class="tocitem" href="../rankdeficiency/">Rank deficiency in mixed-effects models</a></li><li><a class="tocitem" href="../mime/">Alternative display and output formats</a></li><li class="is-active"><a class="tocitem" href>Gradient and Hessian computation</a><ul class="internal"><li><a class="tocitem" href="#via-ForwardDiff.jl"><span>via ForwardDiff.jl</span></a></li><li><a class="tocitem" href="#via-FiniteDiff.jl"><span>via FiniteDiff.jl</span></a></li></ul></li><li><a class="tocitem" href="../limitations/">Limitations of MixedModels.jl</a></li><li><a class="tocitem" href="../formula_syntax/">Formula syntax</a></li><li><a class="tocitem" href="../ecosystem/">Additional Functionality in Other Packages</a></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Gradient and Hessian computation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Gradient and Hessian computation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaStats/MixedModels.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaStats/MixedModels.jl/blob/main/docs/src/derivatives.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Gradient-and-Hessian-computation"><a class="docs-heading-anchor" href="#Gradient-and-Hessian-computation">Gradient and Hessian computation</a><a id="Gradient-and-Hessian-computation-1"></a><a class="docs-heading-anchor-permalink" href="#Gradient-and-Hessian-computation" title="Permalink"></a></h1><p>Experimental support for computing the gradient and the Hessian of the objective function (i.e. negative twice the profiled log likelihood) via ForwardDiff.jl and FiniteDiff.jl are provided as package extensions.</p><h2 id="via-ForwardDiff.jl"><a class="docs-heading-anchor" href="#via-ForwardDiff.jl">via ForwardDiff.jl</a><a id="via-ForwardDiff.jl-1"></a><a class="docs-heading-anchor-permalink" href="#via-ForwardDiff.jl" title="Permalink"></a></h2><p>The core functionality is provided by defining appropriate methods for <code>ForwardDiff.gradient</code> and <code>ForwardDiff.hessian</code>:</p><article><details class="docstring" open="true"><summary id="ForwardDiff.gradient-Union{Tuple{T}, Tuple{LinearMixedModel{T}, Vector{T}}} where T"><a class="docstring-binding" href="#ForwardDiff.gradient-Union{Tuple{T}, Tuple{LinearMixedModel{T}, Vector{T}}} where T"><code>ForwardDiff.gradient</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">ForwardDiff.gradient(f, x::AbstractArray, cfg::GradientConfig = GradientConfig(f, x), check=Val{true}())</code></pre><p>Return <code>∇f</code> evaluated at <code>x</code>, assuming <code>f</code> is called as <code>f(x)</code>. The array <code>∇f</code> has the same shape as <code>x</code>, and its elements are <code>∇f[j, k, ...] = ∂f/∂x[j, k, ...]</code>.</p><p>This method assumes that <code>isa(f(x), Real)</code>.</p><p>Set <code>check</code> to <code>Val{false}()</code> to disable tag checking. This can lead to perturbation confusion, so should be used with care.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDiff/ForwardDiff.jl/blob/v1.3.1/src/gradient.jl#L5-L15">source</a></section><section><div><pre><code class="language-julia hljs">ForwardDiff.gradient(model::LinearMixedModel)</code></pre><p>Evaluate the gradient of the objective function at the currently fitted parameter values.</p><div class="admonition is-warning" id="Large-allocations-19f17bb1bfb12e78"><header class="admonition-header">Large allocations<a class="admonition-anchor" href="#Large-allocations-19f17bb1bfb12e78" title="Permalink"></a></header><div class="admonition-body"><p>Most of MixedModels.jl relies strongly on in-place methods in order to minimize the amount of memory allocated. In addition to reducing the memory burden (especially for large models), this practice generally speeds up evaluation of the objective. In-place methods, however, generally do not play well with automatic differentiation. For the automatic differentiation support provided here, the developers instead implemented alternative, out-of-place methods. These will generally be slower and much more memory intensive, so use of this functionality is <strong>not</strong> recommended for large models.</p></div></div><div class="admonition is-warning" id="ForwardDiff.jl-support-is-experimental.-f9b12d024ecc6ae0"><header class="admonition-header">ForwardDiff.jl support is experimental.<a class="admonition-anchor" href="#ForwardDiff.jl-support-is-experimental.-f9b12d024ecc6ae0" title="Permalink"></a></header><div class="admonition-body"><p>Compatibility with ForwardDiff.jl is experimental. The precise structure, including function names and method definitions, is subject to change without being considered a breaking change. In particular, the exact set of parameters included is subject to change. The θ parameter is always included, but whether σ and/or the fixed effects should be included is currently still being decided.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaStats/MixedModels.jl/blob/9154a8f4009fe955715a6a23ef78f8f9f916061c/ext/MixedModelsForwardDiffExt.jl#L75-L82">source</a></section></details></article><article><details class="docstring" open="true"><summary id="ForwardDiff.hessian-Union{Tuple{T}, Tuple{LinearMixedModel{T}, Vector{T}}} where T"><a class="docstring-binding" href="#ForwardDiff.hessian-Union{Tuple{T}, Tuple{LinearMixedModel{T}, Vector{T}}} where T"><code>ForwardDiff.hessian</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">ForwardDiff.hessian(f, x::AbstractArray, cfg::HessianConfig = HessianConfig(f, x), check=Val{true}())</code></pre><p>Return <code>H(f)</code> (i.e. <code>J(∇(f))</code>) evaluated at <code>x</code>, assuming <code>f</code> is called as <code>f(x)</code>.</p><p>This method assumes that <code>isa(f(x), Real)</code>.</p><p>Set <code>check</code> to <code>Val{false}()</code> to disable tag checking. This can lead to perturbation confusion, so should be used with care.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaDiff/ForwardDiff.jl/blob/v1.3.1/src/hessian.jl#L5-L13">source</a></section><section><div><pre><code class="language-julia hljs">ForwardDiff.hessian(model::LinearMixedModel)</code></pre><p>Evaluate the Hessian of the objective function at the currently fitted parameter values.</p><div class="admonition is-warning" id="Large-allocations-19f17bb1bfb12e78"><header class="admonition-header">Large allocations<a class="admonition-anchor" href="#Large-allocations-19f17bb1bfb12e78" title="Permalink"></a></header><div class="admonition-body"><p>Most of MixedModels.jl relies strongly on in-place methods in order to minimize the amount of memory allocated. In addition to reducing the memory burden (especially for large models), this practice generally speeds up evaluation of the objective. In-place methods, however, generally do not play well with automatic differentiation. For the automatic differentiation support provided here, the developers instead implemented alternative, out-of-place methods. These will generally be slower and much more memory intensive, so use of this functionality is <strong>not</strong> recommended for large models.</p></div></div><div class="admonition is-warning" id="ForwardDiff.jl-support-is-experimental.-f9b12d024ecc6ae0"><header class="admonition-header">ForwardDiff.jl support is experimental.<a class="admonition-anchor" href="#ForwardDiff.jl-support-is-experimental.-f9b12d024ecc6ae0" title="Permalink"></a></header><div class="admonition-body"><p>Compatibility with ForwardDiff.jl is experimental. The precise structure, including function names and method definitions, is subject to change without being considered a breaking change. In particular, the exact set of parameters included is subject to change. The θ parameter is always included, but whether σ and/or the fixed effects should be included is currently still being decided.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaStats/MixedModels.jl/blob/9154a8f4009fe955715a6a23ef78f8f9f916061c/ext/MixedModelsForwardDiffExt.jl#L109-L116">source</a></section></details></article><h3 id="Exact-zero-at-optimum-for-trivial-models"><a class="docs-heading-anchor" href="#Exact-zero-at-optimum-for-trivial-models">Exact zero at optimum for trivial models</a><a id="Exact-zero-at-optimum-for-trivial-models-1"></a><a class="docs-heading-anchor-permalink" href="#Exact-zero-at-optimum-for-trivial-models" title="Permalink"></a></h3><pre><code class="language-julia hljs">using MixedModels, MixedModelsDatasets, ForwardDiff
fm1 = lmm(@formula(yield ~ 1 + (1|batch)), MixedModelsDatasets.dataset(:dyestuff2))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Linear mixed model fit by maximum likelihood
 yield ~ 1 + (1 | batch)
   logLik   -2 logLik     AIC       AICc        BIC    
   -81.4365   162.8730   168.8730   169.7961   173.0766

Variance components:
            Column   Variance Std.Dev.
batch    (Intercept)   0.00000 0.00000
Residual              13.34610 3.65323
 Number of obs: 30; levels of grouping factors: 6

  Fixed-effects parameters:
───────────────────────────────────────────────
              Coef.  Std. Error     z  Pr(&gt;|z|)
───────────────────────────────────────────────
(Intercept)  5.6656    0.666986  8.49    &lt;1e-16
───────────────────────────────────────────────</code></pre><pre><code class="language-julia hljs">ForwardDiff.gradient(fm1)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1-element Vector{Float64}:
 0.0</code></pre><pre><code class="language-julia hljs">ForwardDiff.hessian(fm1)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1×1 Matrix{Float64}:
 28.76868076413998</code></pre><h3 id="Approximate-zero-at-optimum-for-non-trivial-models"><a class="docs-heading-anchor" href="#Approximate-zero-at-optimum-for-non-trivial-models">Approximate zero at optimum for non trivial models</a><a id="Approximate-zero-at-optimum-for-non-trivial-models-1"></a><a class="docs-heading-anchor-permalink" href="#Approximate-zero-at-optimum-for-non-trivial-models" title="Permalink"></a></h3><pre><code class="language-julia hljs">fm2 = lmm(@formula(reaction ~ 1 + days + (1+days|subj)), MixedModelsDatasets.dataset(:sleepstudy))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Linear mixed model fit by maximum likelihood
 reaction ~ 1 + days + (1 + days | subj)
   logLik   -2 logLik     AIC       AICc        BIC    
  -875.9697  1751.9393  1763.9393  1764.4249  1783.0971

Variance components:
            Column    Variance Std.Dev.   Corr.
subj     (Intercept)  565.52071 23.78068
         days          32.68242  5.71685 +0.08
Residual              654.94015 25.59180
 Number of obs: 180; levels of grouping factors: 18

  Fixed-effects parameters:
──────────────────────────────────────────────────
                Coef.  Std. Error      z  Pr(&gt;|z|)
──────────────────────────────────────────────────
(Intercept)  251.405      6.6323   37.91    &lt;1e-99
days          10.4673     1.50224   6.97    &lt;1e-11
──────────────────────────────────────────────────</code></pre><pre><code class="language-julia hljs">ForwardDiff.gradient(fm2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3-element Vector{Float64}:
  0.00014807478304845745
 -0.00027151479254072797
  0.0005646589082459741</code></pre><pre><code class="language-julia hljs">ForwardDiff.hessian(fm2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3×3 Matrix{Float64}:
 45.4118   35.9372    6.356
 35.9372  465.736   203.994
  6.356   203.994   963.95</code></pre><h2 id="via-FiniteDiff.jl"><a class="docs-heading-anchor" href="#via-FiniteDiff.jl">via FiniteDiff.jl</a><a id="via-FiniteDiff.jl-1"></a><a class="docs-heading-anchor-permalink" href="#via-FiniteDiff.jl" title="Permalink"></a></h2><p>The core functionality is provided by defining appropriate methods for <code>FiniteDiff.finite_difference_gradient</code> and <code>FiniteDiff.finite_difference_hessian</code>:</p><article><details class="docstring" open="true"><summary id="FiniteDiff.finite_difference_gradient-Union{Tuple{T}, Tuple{LinearMixedModel{T}, Vector{T}}} where T"><a class="docstring-binding" href="#FiniteDiff.finite_difference_gradient-Union{Tuple{T}, Tuple{LinearMixedModel{T}, Vector{T}}} where T"><code>FiniteDiff.finite_difference_gradient</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">FiniteDiff.finite_difference_gradient(model::LinearMixedModel, args...; kwargs...)</code></pre><p>Evaluate the gradient of the objective function at the currently fitted parameter values.</p><div class="admonition is-warning" id="FiniteDiff.jl-support-is-experimental.-f9048cb56abc1689"><header class="admonition-header">FiniteDiff.jl support is experimental.<a class="admonition-anchor" href="#FiniteDiff.jl-support-is-experimental.-f9048cb56abc1689" title="Permalink"></a></header><div class="admonition-body"><p>Compatibility with FiniteDiff.jl is experimental. The precise structure, including function names and method definitions, is subject to change without being considered a breaking change. In particular, the exact set of parameters included is subject to change. The θ parameter is always included, but whether σ and/or the fixed effects should be included is currently still being decided.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaStats/MixedModels.jl/blob/9154a8f4009fe955715a6a23ef78f8f9f916061c/ext/MixedModelsFiniteDiffExt.jl#L16-L23">source</a></section></details></article><article><details class="docstring" open="true"><summary id="FiniteDiff.finite_difference_hessian-Union{Tuple{T}, Tuple{LinearMixedModel{T}, Vector{T}}} where T"><a class="docstring-binding" href="#FiniteDiff.finite_difference_hessian-Union{Tuple{T}, Tuple{LinearMixedModel{T}, Vector{T}}} where T"><code>FiniteDiff.finite_difference_hessian</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">FiniteDiff.finite_difference_hessian(model::LinearMixedModel, args...; kwargs...)</code></pre><p>Evaluate the Hessian of the objective function at the currently fitted parameter values.</p><div class="admonition is-warning" id="FiniteDiff.jl-support-is-experimental.-f9048cb56abc1689"><header class="admonition-header">FiniteDiff.jl support is experimental.<a class="admonition-anchor" href="#FiniteDiff.jl-support-is-experimental.-f9048cb56abc1689" title="Permalink"></a></header><div class="admonition-body"><p>Compatibility with FiniteDiff.jl is experimental. The precise structure, including function names and method definitions, is subject to change without being considered a breaking change. In particular, the exact set of parameters included is subject to change. The θ parameter is always included, but whether σ and/or the fixed effects should be included is currently still being decided.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaStats/MixedModels.jl/blob/9154a8f4009fe955715a6a23ef78f8f9f916061c/ext/MixedModelsFiniteDiffExt.jl#L37-L44">source</a></section></details></article><pre><code class="language-julia hljs">using FiniteDiff
FiniteDiff.finite_difference_gradient(fm2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3-element Vector{Float64}:
  0.00014822299314916167
 -0.0002720018650722045
  0.0005648056397592629</code></pre><pre><code class="language-julia hljs">FiniteDiff.finite_difference_hessian(fm2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3×3 LinearAlgebra.Symmetric{Float64, Matrix{Float64}}:
  40.8869   31.5168  -14.5287
  31.5168  461.419   183.595
 -14.5287  183.595   867.555</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../mime/">« Alternative display and output formats</a><a class="docs-footer-nextpage" href="../limitations/">Limitations of MixedModels.jl »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Friday 23 January 2026 21:08">Friday 23 January 2026</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
